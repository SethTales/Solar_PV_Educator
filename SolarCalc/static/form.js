
function displayWelcomeMessage()
{
    var title = "Welcome!";
    var p1 = "This tool is designed for homeowners and small business owners in the United States to evaluate the economics of purchasing solar photovoltaic panels \
    to generate electricity onsite.";
    var p2 = "By just entering a few parameters, such as location, electricity cost and system capacity, you can quickly see how much \
    electricity will be generated monthly and yearly, as well as your savings over 20 years. You can quickly compare different scenarios such \
    as fixed or tracking panels, different directional orientations and different panel types to see what is the best option for you.";
    var p3 = "The data generated by this program relies on the National Renewable Energy Laboratory (NREL), which maintains extensive and highly \
    accurate data about solar electricity throughout the United States. Remember though, that the data generated here is based on averages and ideal \
    situations. You should still consult with a solar electricity professionals when deciding what system best meets your needs.";

    document.getElementById("header2").innerHTML = title;
    document.getElementById("p1").innerHTML = p1;
    document.getElementById("p2").innerHTML = p2;
    document.getElementById("p3").innerHTML = p3;
}

function displayResultsMessage()
{
    var title = "Calculation Results";
    var p1 = "The table to the left shows monthly average electricity production in kWh, based on the parameters given."
    var p2 = "The data at bottom right is cost data, that shows estimated costs before incentives, after incentives, and how much \
    you could expect to save over 10 and 20 years, as well as your breakeven year."
    var p3 = "The cost data is based on an average installation cost of $2.75-$3.75, which is consistent with recent average costs \
    reported in the United States. Incentives are averaged at reducing up-front costs by 30%, though this can vary from as little as 20% \
    to as much as 50%."

    document.getElementById("header2").innerHTML = title;
    document.getElementById("p1").innerHTML = p1;
    document.getElementById("p2").innerHTML = p2;
    document.getElementById("p3").innerHTML = p3;
}

function displayTooltip(id)
{
    console.log(id);
    if (id == "zipInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Zip Code";
        var p1 = "This is the zip code of the building or location where you want to install your solar panels. This zip code is used to find the \
        nearest weather station to gather the most accurate projections on how much electricity will be generated based on your site selection."
        var p2 = "";
        var p3 = "";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "costPerKwhInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Cost per Kilowatt-hour";
        var p1 = "This is the price that you pay your utility provider for 1 kilowatt-hour of electricity. The average residential customer \
        uses about 900 kWh per month, but this is highly variable based on your location."
        var p2 = "This number is used to calculate your projected breakeven year, 10-year savings and 20-year savings. The more you pay per kWh \
        the faster your solar panels will pay-off."
        var p3 = "You can find this number on your electricity bill. Most people pay between $0.10-$0.20 per kWh, but again, this is highly dependent \
        on where you live or own your business."

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "sys_capInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Nameplate System Capacity";
        var p1 = "System capacity is a measure of how much electricity your system will generate. Solar panels are generally given a wattage \
        rating, commonly 245W, 300W or 345W. This is how much these panels could generate in direct sunlight, at the ideal angle. A solar system \
        is composed of multiple panels."
        var p2 = "Some common system capacities for home systems are 6kW, 10kW and 15kW. To determine what system capacity is best for you, \
        you must take into account your budget and your annual electricity consumption. If you want to offset most or all of your electricity \
        costs per year, then you need to size your system accordingly."
        var p3 = "Remember, a system capacity is the <b>max rated capacity</b>, not how much will actually be produced. Thankfully, this program \
        takes the guess-work out of calculating your actual electricity output from your system capacity."

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "tiltInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Panel Tilt";
        var p1 = "The angle at which your panels tilt has a large impact on performance. Because the U.S. is in the Northern Hemisphere, sunllight \
        comes from the South, at an angle. Thus, if panels are completely flat, or completely vertical, electricity output will be negatively affected.";
        var p2 = "Most property owners mount their panels on their roof, and thus the angle is largely pre-determined. If this is true for you, measure \
        the angle of your roof, and input that for your tilt value. If you have the space and buget, explore using a solar tracker to increase \
        electricity output per panel.";
        var p3 = "To calculate your ideal tilt angle: If your latitude is < 25 degrees, use your latitude * 0.87. If your latitude is between 25-50 degrees \
        use your latitude * 0.76 plus 3.1 degrees. Lastly, if your latitude is > 50 degrees, use your latitude as the tilt angle.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "azimuthInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Panel Azimuth Angle";
        var p1 = "The azimuth angle is a measure of which direction the panels are oriented. 0 degrees is due North, 90 degrees due East, 180 degrees due South, \
        and 270 degrees due West. Because the U.S. is in the Northern Hemisphere, 180 degrees (due S) is the ideal azimuth angle.";
        var p2 = "However, not all property owners have the luxury of a roof or other surface that points due South. To get the most accurate estimate \
        based on your azimuth angle, use a compass to determine the direction the panels will face, then use that direction to determine the azimuth angle.";
        document.getElementById("azimuthTable").style.display = 'contents';

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = "";
    }

    else if (id == "lossesInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "System Losses"
        var p1 = "Not all electricity that is produced by the panels will be useable. By default, the NREL PvWatts model that is used by this \
        application assumes a default 14% loss from factors including: dirt and grime on panels, shading, wiring, and light-induced degradation.";
        var p2 = "If you expect further losses, add an additonal factor into the losses field. Additional losses could be the result of heavy \
        snowfall, a particularly shady area or if your location experiences dust storms. It is difficult to determine the losses from these categories \
        but a factor of 5-15% is probably safe.";
        var p3 = "If you do not expect further losses beyond what is already modeled, input 0 into the losses field.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "arrTypeInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Array Type";
        var p1 = "The array configuration has large a impact on electricity production. Most homeowners should choose a fixed, roof-mounted setup, \
        as this is a good compromise between cost and efficiency. However, if you have the budget \
        and space consider a single or dual axis tracker.";
        var p2 = "A fixed, open-rack array is generally mounted on the ground, but can be angled as necessary. A fixed, roof-mounted array \
        is mounted on the roof, at the angle of the roof. A 1-axis tracker allows the panel to track the sun, generally from East to West as it \
        rises and sets. This configuration can increase electricity production from 25-35%, but also increases installation and maintenance costs.";
        var p3 = "A 1-axis backtracker uses an algorithm to reduce shading of aligned panels and is generally only used in larger, utility scale systems. \
        Finally, a 2-axis tracker can track the sun in its East-West and North-South axis. This configuration is particularly useful if you live at \
        high latitudes where the sun's location varies significantly throughout the year.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "modTypeInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Module Type";
        var p1 = "A solar array is made up of numerous modules, or panels. The rated efficiency of modules is generally 10-20%, \
        and is dependent on how they are manufactured.";
        var p2 = "Monocrystalline (premium) panels are the most efficient at 18-20%, but are the most expensive \
        type of panel. Polycrystalline panels are mid-range in terms of price and quality, but still achieve a respectable efficiency of 14-17%. \
        Thin film panels are the cheapest and least efficienct panels, and are generally not useful for residential or commercial solar due to their \
        large footprint.";
        var p3 = "Most residential and commercial solar applications should use polycrystalline, or standard panels, as they are still quite efficienct, \
        but of lower cost than monocrystalline panels, while still having a manageable footprint. Remember also to look at the lifetime of the panels when \
        designing a system for your property.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "annualKwhInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Annual Electricity Production";
        var p1 = "This is simply a sum of the monthly electricity data, and is useful for determining if your system is right-sized \
        based on your yearly electricity consumption."
        var p2 = "";
        var p3 = "";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "costBeforeIncentivesInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Upfront Installation Costs";
        var p1 = "This is the estimated upfront costs for installing the system, based on an average cost per watt of $2.75-$3.75."
        var p2 = "More complex systems will generally cost more. Be sure to shop around in your area and get multiple quotes, as this will definitely \
        reduce your costs.";
        var p3 = "";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "costAfterIncentivesInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Costs After Incentives";
        var p1 = "Solar incentives come in many forms, including federal and local tax breaks, utility rebates, feed-in tariffs and more. While you will \
        need to research incentives that you qualify for, use the list at right as a starting point."
        var p2 = "Incentives can save you 20%-50% off the upfront system costs. For our purposes, incentives have been averaged at a flat 30%.";
        var p3 = "";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "breakevenInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Breakeven Year";
        var p1 = "This value represents the year at which the upfront costs of your system will be paid for by the electricity generation of the panels.";
        var p2 = "The breakeven year depends on how much you pay for electricity, and how much you pay for your system, with a higher electricity cost and lower \
        system cost equating to a faster ROI.";
        var p3 = "Remember, you only save money when you use the electricity generated by your panels, unless you are part of a feed-in tariff system. \
        The breakeven calculation assumes that you use 100% of electriciy generated by the panels, though this may not always be the case. Adjust your breakeven \
        epectations accordingly.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "10YearSavingsInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Savings After 10 Years";
        var p1 = "This value represents how much you could save over 10 years based on your system size and electricity cost, and is based off of estimated costs after incentives. \
        Unfortuantely, not all systems have an ROI after 10 years, but many do.";
        var p2 = "Remember, you only save money when you use the electricity generated by your panels, unless you are part of a feed-in tariff system. \
        The 10 year savings calculation assumes that you use 100% of electriciy generated by the panels, though this may not always be the case. Adjust your ROI \
        epectations accordingly."
        var p3 = "Most systems, properly maintained, last 25+ years, so don't be too concerned if your 10 year savings are small or non-existant.";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }

    else if (id == "20YearSavingsInfo")
    {
        document.getElementById("azimuthTable").style.display = 'none';
        var title = "Savings After 20 Years";
        var p1 = "This value represents how much you could save over 20 years based on your system size and electricity cost, and is based off of estimated costs after incentives. \
        If your configuration does not show a savings after 20 years, try running the model with different tilt, azimuth, module or array parameters. \
        However, if an ROI after 20 years looks unlikely, you should reconsider if a solar system is the best choice for your location.";
        var p2 = "Remember, you only save money when you use the electricity generated by your panels, unless you are part of a feed-in tariff system. \
        The 20 year savings calculation assumes that you use 100% of electriciy generated by the panels, though this may not always be the case. Adjust your ROI \
        epectations accordingly."
        var p3 = "";

        document.getElementById("header2").innerHTML = title;
        document.getElementById("p1").innerHTML = p1;
        document.getElementById("p2").innerHTML = p2;
        document.getElementById("p3").innerHTML = p3;
    }
}

var zipList = [];

function readTextFile(file)
{
    
    var zipText = new XMLHttpRequest();
    zipText.open("GET", file, true);
    zipText.onreadystatechange = function()
    {
        if(zipText.readyState == 4)
        {
            console.log(zipText.readyState);
            if(zipText.status == 200 || zipText.status == 0)
            {
                console.log(zipText.status);
                var extractedText = zipText.responseText;
                zipList = extractedText.split("\n");
            }
        }
    }; 
    
    zipText.send(null);
}

function validateZip()
{
    var zipRegEx = /^\d{5}$/;
    var zip = document.getElementById('zip').value;
    var found = zipRegEx.test(zip);
    console.log(zip);

    if(found == true)
    {
        var realZip = checkIfRealZip(zip);
        console.log("realZip=" + realZip);
        if (realZip == true)
        {
            console.log(found);
            var zipError = document.getElementById('zipCodeError').style.display = 'none';
            var zipInput = document.getElementById('zip').style.border = '2px solid green';
            return(true);
        }
        else if (realZip == false)
        {
            var zipError = document.getElementById('zipCodeError').style.display = 'contents';
            var zipInput = document.getElementById('zip').style.border = '2px solid red';
            return(false);
        }
        
    }
    else
    {
        console.log(found);
        var zipError = document.getElementById('zipCodeError').style.display = 'contents';
        var zipInput = document.getElementById('zip').style.border = '2px solid red';
        return(false);
    }
}

function checkIfRealZip(zip)
{
    console.log("zip in checkIfRealZip = " + zip);
    console.log(zipList.length);
    for(var i = 1; i < zipList.length; i++)
    {        
        if(zip == zipList[i])
        {
            return(true);
        }
    }

    return(false);
}

function validateCostPerKwh()
{
    var elecCostRegex = /^[0]?(\.[1-9]+){1}[0-9]{0,2}|^[0]?(\.[0-9]{1}){1}[1-9]{1}[0-9]?/;
    var elecCost = document.getElementById('costPerKwh').value;
    var found = elecCostRegex.test(elecCost);

    if(found == true)
    {
        console.log(found);
        var zipError = document.getElementById('costPerKwhError').style.display = 'none';
        var zipInput = document.getElementById('costPerKwh').style.border = '2px solid green';
        return(true);
        
    }
    else
    {
        console.log(found);
        var zipError = document.getElementById('costPerKwhError').style.display = 'contents';
        var zipInput = document.getElementById('costPerKwh').style.border = '2px solid red';
        return(false);
    }
}

function validateSysCap()
{
    var sysCap = document.getElementById('sys_cap').value;

    if(isNaN(sysCap))
    {
        console.log(false);
        var sys_capError = document.getElementById('sys_capError').style.display = 'contents';
        var sys_capError = document.getElementById('sys_cap').style.border = '2px solid red';
        return(false);
        
    }
    else if(sysCap < 0.05)
    {
        console.log(false);
        var sys_capError = document.getElementById('sys_capError').style.display = 'contents';
        var sys_capError = document.getElementById('sys_cap').style.border = '2px solid red';
        return(false);
    }
    else if(sysCap > 500000)
    {
        console.log(false);
        var sys_capError = document.getElementById('sys_capError').style.display = 'contents';
        var sys_capError = document.getElementById('sys_cap').style.border = '2px solid red';
        return(false);
    }
    else
    {
        console.log(true);
        var sys_capError = document.getElementById('sys_capError').style.display = 'none';
        var sys_capError = document.getElementById('sys_cap').style.border = '2px solid green';
        return(true);
    }
}

function validateTilt()
{
    var tilt = document.getElementById('tilt').value;

    if(isNaN(tilt))
    {
        console.log(false);
        var sys_capError = document.getElementById('tiltError').style.display = 'contents';
        var sys_capError = document.getElementById('tilt').style.border = '2px solid red';
        return(false);
        
    }
    else if(tilt <= 0)
    {
        console.log(false);
        var sys_capError = document.getElementById('tiltError').style.display = 'contents';
        var sys_capError = document.getElementById('tilt').style.border = '2px solid red';
        return(false);
    }
    else if(tilt > 90)
    {
        console.log(false);
        var sys_capError = document.getElementById('tiltError').style.display = 'contents';
        var sys_capError = document.getElementById('tilt').style.border = '2px solid red';
        return(false);
    }
    else
    {
        console.log(true);
        var sys_capError = document.getElementById('tiltError').style.display = 'none';
        var sys_capError = document.getElementById('tilt').style.border = '2px solid green';
        return(true);
    }
}

function validateAzimuth()
{
    var azimuth = document.getElementById('azimuth').value;

    if(isNaN(azimuth))
    {
        console.log(false);
        var sys_capError = document.getElementById('azimuthError').style.display = 'contents';
        var sys_capError = document.getElementById('azimuth').style.border = '2px solid red';
        return(false);
    }
    else if(azimuth < 0)
    {
        console.log(false);
        var sys_capError = document.getElementById('azimuthError').style.display = 'contents';
        var sys_capError = document.getElementById('azimuth').style.border = '2px solid red';
        return(false);
    }
    else if(azimuth > 359.9)
    {
        console.log(false);
        var sys_capError = document.getElementById('azimuthError').style.display = 'contents';
        var sys_capError = document.getElementById('azimuth').style.border = '2px solid red';
        return(false);
    }
    else
    {
        console.log(true);
        var sys_capError = document.getElementById('azimuthError').style.display = 'none';
        var sys_capError = document.getElementById('azimuth').style.border = '2px solid green';
        return(true);
    }
}

function validateLosses()
{
    var losses = document.getElementById('losses').value;

    if(isNaN(losses))
    {
        console.log(false);
        var sys_capError = document.getElementById('lossesError').style.display = 'contents';
        var sys_capError = document.getElementById('losses').style.border = '2px solid red';
        return(false);
        
    }
    else if(losses < 0)
    {
        console.log(false);
        var sys_capError = document.getElementById('lossesError').style.display = 'contents';
        var sys_capError = document.getElementById('losses').style.border = '2px solid red';
        return(false);
    }
    else if(losses > 99)
    {
        console.log(false);
        var sys_capError = document.getElementById('lossesError').style.display = 'contents';
        var sys_capError = document.getElementById('losses').style.border = '2px solid red';
        return(false);
    }
    else
    {
        console.log(true);
        var sys_capError = document.getElementById('lossesError').style.display = 'none';
        var sys_capError = document.getElementById('losses').style.border = '2px solid green';
        return(true);
    }
}

function validateForm()
{
    var bool = validateZip();
    console.log("bool from validateZip = " + bool);
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    bool = validateCostPerKwh()
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    bool = validateSysCap()
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    bool = validateTilt()
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    bool = validateAzimuth()
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    bool = validateLosses()
    if (bool == false)
    {
        alert("One or more of your inputs is incorrect. Please check then re-submit.")
        return(false);
    }
    else
    {
        return(true);
    }
}
